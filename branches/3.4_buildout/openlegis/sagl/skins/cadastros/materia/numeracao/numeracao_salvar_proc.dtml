<dtml-comment>
**************************************************************
*     O metodo abaixo chama o metodo de inserção de dados    *
*  no banco chamado materia_assunto_inserir_zsql e pois      *
*  redireciona para a pagina onde o index esta sendo chamado.*
*  by Michael         em 23/04/2001                          *
**************************************************************
</dtml-comment> 

<dtml-if expr="zsql.numeracao_obter_zsql(cod_materia = hdn_cod_materia, 
                                         num_ordem_atual = hdn_num_ordem,     
                                         tip_materia = lst_tip_materia, 
                                         num_materia = txt_num_materia,
                                         ano_materia = txt_ano_materia,
                                         ind_excluido = 0)">
  <dtml-let mensagem="'Esta numeração já existe para essa matéria.'">
    <dtml-var mensagem_emitir>
  </dtml-let>
<dtml-else>

<dtml-in expr="zsql.numeracao_novo_numero_obter_zsql(cod_materia = hdn_cod_materia)">       
   <dtml-call expr="REQUEST.set('numero', novo_numero)">       
</dtml-in>

<dtml-unless expr="numero">
  <dtml-call expr="REQUEST.set('numero', 1)">
</dtml-unless>

<dtml-if hdn_num_ordem>
  <dtml-call expr="REQUEST.set('metodo', zsql.numeracao_atualizar_zsql)">
<dtml-else>
  <dtml-call expr="REQUEST.set('metodo', zsql.numeracao_incluir_zsql)">
  <dtml-call expr="REQUEST.set('hdn_num_ordem', numero)">
</dtml-if>

<dtml-try>
  <dtml-call expr="metodo(
                        num_ordem   = hdn_num_ordem, 
                        cod_materia = hdn_cod_materia,
                        tip_materia = lst_tip_materia,
                        num_materia = txt_num_materia,
                        ano_materia = txt_ano_materia,
                        dat_materia = pysc.data_converter_pysc(data = txt_dat_materia)
                        )">
<dtml-except>
  <dtml-let mensagem="'Não foi possível salvar a numeração!'">
    <dtml-var mensagem_emitir>
  </dtml-let>   
<dtml-else>
  <dtml-let mensagem="'Numeração salva com sucesso!'" sucesso="1" url=hdn_url>
    <dtml-var mensagem_emitir>
  </dtml-let>
</dtml-try>

</dtml-if>
