"undefined"==typeof window.lacunaWebPKIExtension&&(window.lacunaWebPKIExtension=null),window.LacunaWebPKI=null,LacunaWebPKI=function(a){this.license=null,this.defaultFailCallback=null,this.angularScope=null,this.ngZone=null,this.brand=null,this.restPkiUrl=null,this.useDomainNativePool=!1,this.mobileIntegrationMode=null,a&&(this.license=a)},function(a){a.Promise=function(a,b){this.successCallback=function(){},this.failCallback=null,this.angularScope=a,this.ngZone=b},a.Promise.prototype.success=function(a){return this.successCallback=a,this},a.Promise.prototype.error=function(a){return this.failCallback=function(b){a(b.message,b.error,b.origin,b.code)},this},a.Promise.prototype.fail=function(a){return this.failCallback=a,this},a.Promise.prototype._invokeSuccess=function(b,c){if(c>0){var d=this;setTimeout(function(){d._invokeSuccess(b)},c)}else{var e=this.successCallback||function(){a._log("Success ignored (no callback registered)")};this._apply(function(){e(b)})}},a.Promise.prototype._invokeError=function(a,b){if(b>0){var c=this;setTimeout(function(){c._invokeError(a)},b)}else{var d=this.failCallback||function(a){throw"Web PKI error originated at "+a.origin+": "+a.message+"\n"+a.complete+"\ncode: "+a.code};this._apply(function(){d({userMessage:a.userMessage||a.message,message:a.message,error:a.complete,origin:a.origin,code:a.code})})}},a.Promise.prototype._apply=function(a){if(this.angularScope){var b=this.angularScope.$root.$$phase;"$apply"==b||"$digest"==b?a():this.angularScope.$apply(function(){a()})}else this.ngZone?this.ngZone.run(function(){a()}):a()},a._installUrl="https://get.webpkiplugin.com/",a._chromeExtensionId="dcngeagmmhegagicpcmpinaoklddcgon",a._firefoxExtensionId="webpki@lacunasoftware.com",a._edgeExtensionId="d2798a85-9698-425a-add7-3db79a39ca8a",a._chromeExtensionFirstVersionWithSelfUpdate="2.0.20",a._jslibVersion="2.14.6",a._mobileSupported=!0,a._buildChannel="stable",a._extensionRequiredVersion="2.15.0",a._chromeNativeWinRequiredVersion="2.10.1",a._chromeNativeLinuxRequiredVersion="2.10.0",a._chromeNativeMacRequiredVersion="2.10.0",a._ieAddonRequiredVersion="2.7.2",a._mobileRequiredVersion="2.7.0",a._chromeInstallationStates={INSTALLED:0,EXTENSION_NOT_INSTALLED:1,EXTENSION_OUTDATED:2,NATIVE_NOT_INSTALLED:3,NATIVE_OUTDATED:4},a._certKeyUsages={crlSign:2,dataEncipherment:16,decipherOnly:32768,digitalSignature:128,encipherOnly:1,keyAgreement:8,keyCertSign:4,keyEncipherment:32,nonRepudiation:64},a.apiVersions={v1_0:"1.0",v1_1:"1.1",v1_2:"1.2",v1_3:"1.3",v1_4:"1.4",v1_4_1:"1.4.1",v1_5:"1.5",v1_5_1:"1.5.1",v1_5_2:"1.5.2",v1_6:"1.6.0",v1_6_1:"1.6.1",latest:"latest"},a._apiMap={nativeWin:{},nativeLinux:{},nativeMac:{},ieAddon:{},extension:{},mobile:{}},a._apiMap.nativeWin[a.apiVersions.v1_0]="2.1.0",a._apiMap.nativeWin[a.apiVersions.v1_1]="2.3.0",a._apiMap.nativeWin[a.apiVersions.v1_2]="2.4.1",a._apiMap.nativeWin[a.apiVersions.v1_3]="2.5.0",a._apiMap.nativeWin[a.apiVersions.v1_4]="2.6.2",a._apiMap.nativeWin[a.apiVersions.v1_4_1]="2.6.5",a._apiMap.nativeWin[a.apiVersions.v1_5]="2.8.0",a._apiMap.nativeWin[a.apiVersions.v1_5_1]="2.8.1",a._apiMap.nativeWin[a.apiVersions.v1_5_2]="2.9.0",a._apiMap.nativeWin[a.apiVersions.v1_6]="2.10.0",a._apiMap.nativeWin[a.apiVersions.v1_6_1]="2.10.1",a._apiMap.ieAddon[a.apiVersions.v1_0]="2.0.4",a._apiMap.ieAddon[a.apiVersions.v1_1]="2.1.1",a._apiMap.ieAddon[a.apiVersions.v1_2]="2.2.4",a._apiMap.ieAddon[a.apiVersions.v1_3]="2.3.0",a._apiMap.ieAddon[a.apiVersions.v1_4]="2.4.2",a._apiMap.ieAddon[a.apiVersions.v1_4_1]="2.4.5",a._apiMap.ieAddon[a.apiVersions.v1_5]="2.5.0",a._apiMap.ieAddon[a.apiVersions.v1_5_1]="2.5.2",a._apiMap.ieAddon[a.apiVersions.v1_5_2]="2.6.0",a._apiMap.ieAddon[a.apiVersions.v1_6]="2.7.0",a._apiMap.ieAddon[a.apiVersions.v1_6_1]="2.7.2",a._apiMap.nativeLinux[a.apiVersions.v1_0]="2.0.0",a._apiMap.nativeLinux[a.apiVersions.v1_1]="2.4.0",a._apiMap.nativeLinux[a.apiVersions.v1_2]="2.6.2",a._apiMap.nativeLinux[a.apiVersions.v1_3]="2.7.0",a._apiMap.nativeLinux[a.apiVersions.v1_4]="2.7.4",a._apiMap.nativeLinux[a.apiVersions.v1_4_1]="2.7.4",a._apiMap.nativeLinux[a.apiVersions.v1_5]="2.9.0",a._apiMap.nativeLinux[a.apiVersions.v1_5_1]="2.9.0",a._apiMap.nativeLinux[a.apiVersions.v1_5_2]="2.9.5",a._apiMap.nativeLinux[a.apiVersions.v1_6]="2.10.0",a._apiMap.nativeLinux[a.apiVersions.v1_6_1]="2.10.0",a._apiMap.nativeMac[a.apiVersions.v1_0]="2.3.0",a._apiMap.nativeMac[a.apiVersions.v1_1]="2.4.0",a._apiMap.nativeMac[a.apiVersions.v1_2]="2.6.1",a._apiMap.nativeMac[a.apiVersions.v1_3]="2.7.0",a._apiMap.nativeMac[a.apiVersions.v1_4]="2.7.4",a._apiMap.nativeMac[a.apiVersions.v1_4_1]="2.7.4",a._apiMap.nativeMac[a.apiVersions.v1_5]="2.9.0",a._apiMap.nativeMac[a.apiVersions.v1_5_1]="2.9.0",a._apiMap.nativeMac[a.apiVersions.v1_5_2]="2.9.5",a._apiMap.nativeMac[a.apiVersions.v1_6]="2.10.0",a._apiMap.nativeMac[a.apiVersions.v1_6_1]="2.10.0",a._apiMap.extension[a.apiVersions.v1_0]="2.3.2",a._apiMap.extension[a.apiVersions.v1_1]="2.7.0",a._apiMap.extension[a.apiVersions.v1_2]="2.9.1",a._apiMap.extension[a.apiVersions.v1_3]="2.10.1",a._apiMap.extension[a.apiVersions.v1_4]="2.11.7",a._apiMap.extension[a.apiVersions.v1_4_1]="2.11.7",a._apiMap.extension[a.apiVersions.v1_5]="2.13.0",a._apiMap.extension[a.apiVersions.v1_5_1]="2.13.0",a._apiMap.extension[a.apiVersions.v1_5_2]="2.14.2",a._apiMap.extension[a.apiVersions.v1_6]="2.15.0",a._apiMap.extension[a.apiVersions.v1_6_1]="2.15.0",a._apiMap.mobile[a.apiVersions.v1_0]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_1]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_2]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_3]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_4]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_4_1]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_5]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_5_1]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_5_2]="1.1.0",a._apiMap.mobile[a.apiVersions.v1_6]="2.7.0",a._apiMap.mobile[a.apiVersions.v1_6_1]="2.7.0",a._apiMap.nativeWin[a.apiVersions.latest]=a._chromeNativeWinRequiredVersion,a._apiMap.ieAddon[a.apiVersions.latest]=a._ieAddonRequiredVersion,a._apiMap.nativeLinux[a.apiVersions.latest]=a._chromeNativeLinuxRequiredVersion,a._apiMap.nativeMac[a.apiVersions.latest]=a._chromeNativeMacRequiredVersion,a._apiMap.extension[a.apiVersions.latest]=a._extensionRequiredVersion,a._apiMap.mobile[a.apiVersions.latest]=a._mobileRequiredVersion,a._nativeInfo={},a.installationStates={INSTALLED:0,NOT_INSTALLED:1,OUTDATED:2,BROWSER_NOT_SUPPORTED:3},a.isSupportedMobile=void 0,a.certificateValidationLevels={full:"full",offline:"offline"},a.padesPolicies={basic:"basic",brazilAdrBasica:"brazilAdrBasica"},a.cadesPolicies={bes:"cadesBes",brazilAdrBasica:"brazilAdrBasica"},a.xmlPolicies={xmlDSig:"xmlDSig",xadesBes:"xadesBes",brazilNFe:"brazilNFe",brazilAdrBasica:"brazilAdrBasica"},a.cadesAcceptablePolicies={pkiBrazil:["brazilAdrBasica","brazilAdrTempo","brazilAdrValidacao","brazilAdrCompleta","brazilAdrArquivamento"]},a.xmlAcceptablePolicies={pkiBrazil:["brazilAdrBasica","brazilAdrTempo"]},a.standardTrustArbitrators={pkiBrazil:{type:"standard",standardArbitrator:"pkiBrazil"},pkiItaly:{type:"standard",standardArbitrator:"pkiItaly"},pkiPeru:{type:"standard",standardArbitrator:"pkiPeru"},windows:{type:"standard",standardArbitrator:"windows"}},a.xmlInsertionOptions={appendChild:"appendChild",prependChild:"prependChild",appendSibling:"appendSibling",prependSibling:"prependSibling"},a.outputModes={showSaveFileDialog:"showSaveFileDialog",saveInFolder:"saveInFolder",autoSave:"autoSave",returnContent:"returnContent"},a.trustArbitratorTypes={trustedRoot:"trustedRoot",tsl:"tsl",standard:"standard"},a.padesPaperSizes={custom:"custom",a0:"a0",a1:"a1",a2:"a2",a3:"a3",a4:"a4",a5:"a5",a6:"a6",a7:"a7",a8:"a8",letter:"letter",legal:"legal",ledger:"ledger"},a.padesHorizontalAlign={left:"left",center:"center",rigth:"rigth"},a.padesVerticalAlign={top:"top",center:"center",bottom:"bottom"},a.padesMeasurementUnits={centimeters:"centimeters",pdfPoints:"pdfPoints"},a.padesPageOrientations={auto:"auto",portrait:"portrait",landscape:"landscape"},a.padesAutoPositioningHorizontalDirections={leftToRight:"leftToRight",rightToLeft:"rightToLeft"},a.padesAutoPositioningVerticalDirections={topDown:"topDown",bottomUp:"bottomUp"},a.markElementTypes={text:"text",image:"image"},a.markTextStyle={normal:0,bold:1,italic:2},a.passwordPolicies={lettersAndNumbers:1,upperAndLowerCase:2,specialCharacters:4},a.pkcs11Modules={safeSign:{win:"aetpkss1.dll",linux:"libaetpkss.so.3",mac:"libaetpkss.dylib"},safeNet:{win:"eTPKCS11.dll",linux:"libeToken.so",mac:"libeToken.dylib"}},a.mobileIntegrationModes={appIntegration:"appIntegration",browserIntegration:"browserIntegration"},a._parseDataUrl=function(b){var c=/^data:(.+);base64,(.+)$/.exec(b);return c?{mimeType:c[1],content:c[2]}:(a._log("failed to parse data url"),null)},a._downloadResource=function(b,c){a._log("resolving resource reference: "+b);var d=new XMLHttpRequest;d.open("GET",b),d.responseType="blob",d.onload=function(){var b=new FileReader;b.onloadend=function(){a._log("resource reference resolved");var d=a._parseDataUrl(b.result);c(d)},b.readAsDataURL(d.response)},d.send()},a._getRequestOsP11Modules=function(b){if(!b||!b.length)return null;for(var c=[],d=0;d<b.length;d++)"Windows"===a._nativeInfo.os?c.push(b[d].win):"Linux"===a._nativeInfo.os?c.push(b[d].linux):"Darwin"===a._nativeInfo.os&&c.push(b[d].mac);return c},a._handleP11ModulesArgs=function(a,b){var c=null,d=null;a.token&&"object"==typeof a.token&&(c=[a.token.pkcs11Module],d=a.token.serialNumber),b.pkcs11Modules=c||b.pkcs11Modules,b.tokenSerialNumber=d||b.tokenSerialNumber},a.errorCodes={UNDEFINED:"undefined",INTERNAL:"internal",USER_CANCELLED:"user_cancelled",OS_NOT_SUPPORTED:"os_not_supported",ADDON_TIMEOUT:"addon_timeout",ADDON_NOT_DETECTED:"addon_not_detected",ADDON_SEND_COMMAND_FAILURE:"addon_send_command_failure",CERTIFICATE_NOT_FOUND:"certificate_not_found",COMMAND_UNKNOWN:"command_unknown",COMMAND_NOT_SUPPORTED:"command_not_supported",COMMAND_PARAMETER_NOT_SET:"command_parameter_not_set",COMMAND_INVALID_PARAMETER:"command_invalid_parameter",NATIVE_CONNECT_FAILURE:"native_connect_failure",NATIVE_DISCONNECTED:"native_disconnected",NATIVE_NO_RESPONSE:"native_no_response",REST_PKI_GET_PENDING_SIGNATURE:"rest_pki_get_pending_signature",REST_PKI_POST_SIGNATURE:"rest_pki_post_signature",REST_PKI_INVALID_CERTIFICATE:"rest_pki_invalid_certificate",LICENSE_NOT_SET:"license_not_set",LICENSE_INVALID:"license_invalid",LICENSE_RESTRICTED:"license_restricted",LICENSE_EXPIRED:"license_expired",LICENSE_DOMAIN_NOT_ALLOWED:"license_domain_not_allowed",VALIDATION_ERROR:"validation_error",P11_ERROR:"p11_error",P11_TOKEN_NOT_FOUND:"p11_token_not_found",P11_NOT_SUPPORTED:"p11_not_supported",KEYSET_NOT_FOUND:"keyset_not_found",ALGORITHM_NOT_SUPPORTED:"algorithm_not_supported",SIGNED_PDF_TO_MARK:"signed_pdf_to_mark",JSON_ERROR:"json_error",IO_ERROR:"io_error",KEYCHAIN_ERROR:"keychain_error",KEYCHAIN_SIGN_ERROR:"keychain_sign_error",DECODE_ERROR:"decode_error",CSP_KEYSET_NOT_DEFINED:"csp_keyset_not_defined",CSP_INVALID_ALGORITHM:"csp_invalid_algorithm",CSP_INVALID_PROVIDER_TYPE:"csp_invalid_provider_type",MOBILE_TIMEOUT:"mobile_timeout",MOBILE_NOT_AUTHORIZED:"mobile_not_authorized",MOBILE_SEND_MESSAGE:"mobile_send_message",COMMAND_DECRYPT_ERROR:"command_decrypt_error",BLOCKED_DOMAIN:"blocked_domain"},a._compareVersions=function(a,b){function c(a){return/^\d+$/.test(a)}function d(a){for(var b=0;b<a.length;++b)if(!c(a[b]))return!1;return!0}var e=a.split("."),f=b.split(".");if(!d(e)||!d(f))return NaN;for(var g=0;g<e.length;++g){if(f.length===g)return 1;var h=parseInt(e[g],10),i=parseInt(f[g],10);if(h!==i)return h>i?1:-1}return e.length!=f.length?-1:0},a._log=function(a,b){window.console&&(b?window.console.log(a,b):window.console.log(a))},a._createContext=function(b){var c=new a.Promise(this.angularScope,this.ngZone);b&&b.success&&c.success(b.success),b&&b.fail?c.fail(b.fail):b&&b.error?c.error(b.error):c.fail(this.defaultFailCallback);var d={promise:c,license:this.license,useDomainNativePool:this.useDomainNativePool,instance:a._supportedMobileDetected?this:void 0};return d},a.init=function(b){if(b?"function"==typeof b&&(b={ready:b}):b={},b.license&&(this.license=b.license),b.defaultError&&(this.defaultFailCallback=function(a){b.defaultError(a.message,a.error,a.origin,a.code)}),b.defaultFail&&(this.defaultFailCallback=b.defaultFail),b.angularScope&&(this.angularScope=b.angularScope),b.ngZone&&(this.ngZone=b.ngZone),b.brand&&(this.brand=b.brand),b.restPkiUrl&&(this.restPkiUrl=b.restPkiUrl),this.useDomainNativePool=b.useDomainNativePool===!0,a.isSupportedMobile&&window.$&&window.$.blockUI)try{window.$.blockUI.defaults.bindEvents=!1}catch(c){a._log("Error disabling blockUI bindEvents: ",c)}var d=this,e=function(c){c.isInstalled?b.ready?b.ready():a._log("Web PKI ready (no callback registered)"):b.notInstalled?b.notInstalled(c.status,c.message,c.browserSpecificStatus):d.redirectToInstallPage()},f=this._createContext({success:e,fail:b.fail,error:b.error});return a._requestHandler.checkInstalled(f,b.requiredApiVersion),f.promise},a.getVersion=function(b){var c=this._createContext(b);return a._requestHandler.sendCommand(c,"getVersion",null),c.promise},a.listCertificates=function(b){if(b){if(b.filter&&"function"!=typeof b.filter)throw"boolean"==typeof b.filter?'args.filter must be a function (hint: if you used "pki.filters.xxx()", try removing the "()")':"args.filter must be a function, received "+typeof b.filter}else b={};var c=this._createContext(b);return a._requestHandler.sendCommand(c,"listCertificates",null,function(c){return a._processCertificates(c,b.filter,b.selectId,b.selectOptionFormatter)}),c.promise},a._processCertificates=function(b,c,d,e){for(var f=[],g=0;g<b.length;g++){var h=b[g];if(h.validityStart=new Date(h.validityStart),h.validityEnd=new Date(h.validityEnd),h.keyUsage=a._processKeyUsage(h.keyUsage),h.pkiBrazil&&h.pkiBrazil.dateOfBirth){var i=h.pkiBrazil.dateOfBirth;h.pkiBrazil.dateOfBirth=new Date(parseInt(i.slice(0,4),10),parseInt(i.slice(5,7),10)-1,parseInt(i.slice(8,10),10))}c?c(h)&&f.push(h):f.push(h)}if(f.sort(function(a,b){var c=a.subjectName,d=b.subjectName;return c&&d?(c=c.toLowerCase(),d=d.toLowerCase(),c>d?1:c<d?-1:a.validityEnd>b.validityEnd?-1:a.validityEnd<b.validityEnd?1:0):!c&&d?1:-1}),d){e||(e=function(a){return a.subjectName+" (issued by "+a.issuerName+")"});for(var j=document.getElementById(d);j.options.length>0;)j.remove(0);for(var k=0;k<f.length;k++){var l=f[k],m=document.createElement("option");m.value=l.thumbprint,m.text=e(l),j.add(m)}}return f},a._processKeyUsage=function(b){return{crlSign:0!==(b&a._certKeyUsages.crlSign),dataEncipherment:0!==(b&a._certKeyUsages.dataEncipherment),decipherOnly:0!==(b&a._certKeyUsages.decipherOnly),digitalSignature:0!==(b&a._certKeyUsages.digitalSignature),encipherOnly:0!==(b&a._certKeyUsages.encipherOnly),keyAgreement:0!==(b&a._certKeyUsages.keyAgreement),keyCertSign:0!==(b&a._certKeyUsages.keyCertSign),keyEncipherment:0!==(b&a._certKeyUsages.keyEncipherment),nonRepudiation:0!==(b&a._certKeyUsages.nonRepudiation)}},a.filters={isPkiBrazilPessoaFisica:function(a){if("undefined"==typeof a)throw'filter called without cert argument (hint: if you are using "pki.filters.isPkiBrazilPessoaFisica()", try "pki.filters.isPkiBrazilPessoaFisica")';return a.pkiBrazil&&""!==(a.pkiBrazil.cpf||"")&&""===(a.pkiBrazil.cnpj||"")},hasPkiBrazilCpf:function(a){if("undefined"==typeof a)throw'filter called without cert argument (hint: if you are using "pki.filters.hasPkiBrazilCpf()", try "pki.filters.hasPkiBrazilCpf")';return a.pkiBrazil&&""!==(a.pkiBrazil.cpf||"")},hasPkiBrazilCnpj:function(a){if("undefined"==typeof a)throw'filter called without cert argument (hint: if you are using "pki.filters.hasPkiBrazilCnpj()", try "pki.filters.hasPkiBrazilCnpj")';return a.pkiBrazil&&""!==(a.pkiBrazil.cnpj||"")},pkiBrazilCpfEquals:function(a){if("string"!=typeof a)throw'cpf must be a string (hint: if you are using "pki.filters.pkiBrazilCpfEquals", try "pki.filters.pkiBrazilCpfEquals(\'somecpf\')")';return function(b){return b.pkiBrazil&&b.pkiBrazil.cpf===a}},pkiBrazilCnpjEquals:function(a){if("string"!=typeof a)throw'cnpj must be a string (hint: if you are using "pki.filters.pkiBrazilCnpjEquals", try "pki.filters.pkiBrazilCnpjEquals(\'somecnpj\')")';return function(b){return b.pkiBrazil&&b.pkiBrazil.cnpj===a}},hasPkiItalyCodiceFiscale:function(a){if("undefined"==typeof a)throw'filter called without cert argument (hint: if you are using "pki.filters.hasPkiItalyCodiceFiscale()", try "pki.filters.hasPkiItalyCodiceFiscale")';return a.pkiItaly&&""!==(a.pkiItaly.codiceFiscale||"")},pkiItalyCodiceFiscaleEquals:function(a){if("string"!=typeof a)throw'cf must be a string (hint: if you are using "pki.filters.pkiItalyCodiceFiscaleEquals", try "pki.filters.pkiItalyCodiceFiscaleEquals(\'someCodice\')")';return function(b){return b.pkiItaly&&b.pkiItaly.codiceFiscale===a}},isWithinValidity:function(a){if("undefined"==typeof a)throw'filter called without cert argument (hint: if you are using "pki.filters.isWithinValidity()", try "pki.filters.isWithinValidity")';var b=new Date;return a.validityStart<=b&&b<=a.validityEnd},all:function(){var a;return a=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,function(b){for(var c=0;c<a.length;c++){var d=a[c];if(!d(b))return!1}return!0}},any:function(){var a;return a=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,function(b){for(var c=0;c<a.length;c++){var d=a[c];if(d(b))return!0}return!1}}},a.readCertificate=function(b){"string"==typeof b&&(b={thumbprint:b});var c=this._createContext(b);return a._requestHandler.sendCommand(c,"readCertificate",{certificateThumbprint:b.thumbprint}),c.promise},a.pollNative=function(b){b||(b={});var c=this._createContext(b),d=b.requiredApiVersion;if(d||(d=a.apiVersions.latest),!a._apiMap.nativeWin[d])throw"Unknown JSlib API version: "+d;return a._requestHandler.sendCommand(c,"pollNative",{requiredNativeWinVersion:a._apiMap.nativeWin[d],requiredNativeLinuxVersion:a._apiMap.nativeLinux[d],requiredNativeMacVersion:a._apiMap.nativeMac[d]}),c.promise},a.signHash=function(b){var c=this._createContext(b),d={certificateThumbprint:b.thumbprint,hash:b.hash,digestAlgorithm:b.digestAlgorithm};return a._requestHandler.sendCommand(c,"signHash",d),c.promise},a.signData=function(b){var c=this._createContext(b),d={certificateThumbprint:b.thumbprint,data:b.data,digestAlgorithm:b.digestAlgorithm};return a._requestHandler.sendCommand(c,"signData",d),c.promise},a.keySignHash=function(b){var c=this._createContext(b),d={privateKeyId:b.privateKeyId,hash:b.hash,digestAlgorithm:b.digestAlgorithm,pkcs11Modules:a._getRequestOsP11Modules(b.pkcs11Modules),tokenSerialNumber:b.tokenSerialNumber};return a._handleP11ModulesArgs(b,d),a._requestHandler.sendCommand(c,"keySignHash",d),c.promise},a.keySignData=function(b){var c=this._createContext(b),d={privateKeyId:b.privateKeyId,data:b.data,digestAlgorithm:b.digestAlgorithm,pkcs11Modules:a._getRequestOsP11Modules(b.pkcs11Modules),tokenSerialNumber:b.tokenSerialNumber};return a._handleP11ModulesArgs(b,d),a._requestHandler.sendCommand(c,"keySignData",d),c.promise},a.signWithRestPki=function(b){var c=this._createContext(b),d={certificateThumbprint:b.thumbprint,token:b.token,restPkiUrl:this.restPkiUrl};return a._requestHandler.sendCommand(c,"signWithRestPki",d),c.promise},a.signHashBatch=function(b){var c=this._createContext(b),d={certificateThumbprint:b.certificateThumbprint,digestAlgorithm:b.digestAlgorithm,batch:b.batch};return a._requestHandler.sendCommand(c,"signHashBatch",d),c.promise},a.preauthorizeSignatures=function(b){b||(b={});var c=this._createContext(b),d={certificateThumbprint:b.certificateThumbprint,signatureCount:b.signatureCount};return a._requestHandler.sendCommand(c,"preauthorizeSignatures",d),c.promise},a.showFolderBrowser=function(b){b?"string"==typeof b&&(b={message:b}):b={};var c=this._createContext(b),d={message:b.message};return a._requestHandler.sendCommand(c,"showFolderBrowser",d),c.promise},a.showFileBrowser=function(b){b||(b={});var c=this._createContext(b),d={multiselect:b.multiselect,filters:b.filters,dialogTitle:b.dialogTitle};return a._requestHandler.sendCommand(c,"showFileBrowser",d),c.promise},a.downloadToFolder=function(b){b||(b={});var c=b.url||"";if(c.indexOf("://")<0){var d=document.createElement("a");d.href=c,c=d.href}var e=this._createContext(b),f={url:c,folderId:b.folderId,filename:b.filename};return a._requestHandler.sendCommand(e,"downloadToFolder",f),e.promise},a.openFolder=function(b){b?"string"==typeof b&&(b={folderId:b}):b={};var c=this._createContext(b);return a._requestHandler.sendCommand(c,"openFolder",b.folderId),c.promise},a.openFile=function(b){b?"string"==typeof b&&(b={fileId:b}):b={};var c=this._createContext(b);return a._requestHandler.sendCommand(c,"openFile",b.fileId),c.promise},a.redirectToInstallPage=function(){document.location.href=a._installUrl+(this.brand||"")+"?returnUrl="+encodeURIComponent(document.URL)+"&jslib="+a._jslibVersion},a.updateExtension=function(b){b||(b={});var c=this._createContext(b);return a._requestHandler.sendCommand(c,"updateExtension",null),c.promise},a._createCommonSignerRequest=function(a){if(!a.output)throw"An output parameter must be passed to signer methods";return{fileId:a.fileId,content:a.content,certificateThumbprint:a.certificateThumbprint,output:{mode:a.output.mode,folderId:a.output.folderId,dialogTitle:a.output.dialogTitle,fileNameSuffix:a.output.fileNameSuffix},trustArbitrators:a.trustArbitrators,clearPolicyTrustArbitrators:a.clearPolicyTrustArbitrators,certificateValidationLevel:a.certificateValidationLevel,timestampRequester:a.timestampRequester,policy:a.policy}},a.signPdf=function(b){var c=this._createContext(b),d=a._createCommonSignerRequest(b);return d.visualRepresentation=b.visualRepresentation,d.pdfMarks=b.pdfMarks,d.bypassMarksIfSigned=b.bypassMarksIfSigned,d.visualRepresentation&&d.visualRepresentation.image&&d.visualRepresentation.image.resource&&!d.visualRepresentation.image.resource.content&&d.visualRepresentation.image.resource.url&&!/^(https?:)?\/\//.exec(d.visualRepresentation.image.resource.url)?a._downloadResource(d.visualRepresentation.image.resource.url,function(b){d.visualRepresentation.image.resource=b,a._requestHandler.sendCommand(c,"signPdf",d)}):a._requestHandler.sendCommand(c,"signPdf",d),c.promise},a.signCades=function(b){var c=this._createContext(b),d=a._createCommonSignerRequest(b);return d.cmsToCosignFileId=b.cmsToCosignFileId,d.autoDetectCosign=b.autoDetectCosign,d.includeEncapsulatedContent=null===b.includeEncapsulatedContent||void 0===b.includeEncapsulatedContent||b.includeEncapsulatedContent,a._requestHandler.sendCommand(c,"signCades",d),c.promise},a.signFullXml=function(b){var c=this._createContext(b),d=a._createCommonSignerRequest(b);return d.signerType="fullXml",a._signXmlCommon(b,d,c),c.promise},a.signXmlElement=function(b){var c=this._createContext(b),d=a._createCommonSignerRequest(b);return d.signerType="xmlElement",d.toSignElementId=b.toSignElementId,d.toSignElementsIds=b.toSignElementsIds,d.toSignElementsXPath=b.toSignElementsXPath,d.idResolutionTable=b.idResolutionTable,a._signXmlCommon(b,d,c),c.promise},a._signXmlCommon=function(b,c,d){c.signatureElementId=b.signatureElementId,b.signatureElementLocation&&(c.signatureElementLocation={xpath:b.signatureElementLocation.xpath,insertionOption:b.signatureElementLocation.insertionOption}),c.namespaces=b.namespaces,a._requestHandler.sendCommand(d,"signXml",c)},a._createCommonOpenRequest=function(a){return{signatureFileId:a.signatureFileId,signatureContent:a.signatureContent,validate:a.validate,dateReference:a.dateReference,trustArbitrators:a.trustArbitrators,clearPolicyTrustArbitrators:a.clearPolicyTrustArbitrators,specificPolicy:a.specificPolicy}},a.openPades=function(b){var c=this._createContext(b),d=a._createCommonOpenRequest(b);return a._requestHandler.sendCommand(c,"openPades",d),c.promise},a.openCades=function(b){var c=this._createContext(b),d=a._createCommonOpenRequest(b);return d.originalFileId=b.originalFileId,d.originalContent=b.originalContent,d.acceptablePolicies=b.acceptablePolicies,a._requestHandler.sendCommand(c,"openCades",d),c.promise},a.openXmlSignature=function(b){var c=this._createContext(b),d=a._createCommonOpenRequest(b);return d.idResolutionTable=b.idResolutionTable,d.acceptablePolicies=b.acceptablePolicies,a._requestHandler.sendCommand(c,"openXmlSignature",d),c.promise},a.listTokens=function(b){var c=this._createContext(b),d={pkcs11Modules:a._getRequestOsP11Modules(b.pkcs11Modules)};return a._requestHandler.sendCommand(c,"listTokens",d),c.promise},a.generateTokenRsaKeyPair=function(b){var c=this._createContext(b),d={pkcs11Modules:a._getRequestOsP11Modules(b.pkcs11Modules),subjectName:b.subjectName,tokenSerialNumber:b.tokenSerialNumber,keyLabel:b.keyLabel,keySize:b.keySize};return a._handleP11ModulesArgs(b,d),a._requestHandler.sendCommand(c,"generateTokenRsaKeyPair",d),c.promise},a.generateSoftwareRsaKeyPair=function(b){var c=this._createContext(b),d={subjectName:b.subjectName,keySize:b.keySize};return a._requestHandler.sendCommand(c,"generateSoftwareRsaKeyPair",d),c.promise},a.importTokenCertificate=function(b){var c=this._createContext(b),d={privateKeyId:b.privateKeyId,pkcs11Modules:a._getRequestOsP11Modules(b.pkcs11Modules),tokenSerialNumber:b.tokenSerialNumber,certificateContent:b.certificateContent,certificateLabel:b.certificateLabel};return a._handleP11ModulesArgs(b,d),a._requestHandler.sendCommand(c,"importTokenCertificate",d),c.promise},a.importCertificate=function(b){var c=this._createContext(b),d={privateKeyId:b.privateKeyId,certificateContent:b.certificateContent,passwordPolicies:b.passwordPolicies,passwordMinLength:b.passwordMinLength,savePkcs12:b.savePkcs12};return a._requestHandler.sendCommand(c,"importCertificate",d),c.promise},a.sendAuthenticatedRequest=function(b){var c=this._createContext(b),d={certificateThumbprint:b.certificateThumbprint,method:b.method,headers:b.headers,body:b.body,url:b.url};return a._requestHandler.sendCommand(c,"sendAuthenticatedRequest",d),c.promise},a.detectedBrowser=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!==a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))}(),a._supportedMobileDetected=!1;var b=function(){for(var b=navigator.userAgent,c="",d=[{s:"Android",r:/Android/},{s:"iOS",r:/(iPhone|iPad|iPod)/}],e=0;e<d.length;e++){var f=d[e];if(f.r.test(b)){c=f.s,a._supportedMobileDetected=a._mobileSupported;break}}return c}();if(a.isSupportedMobile=a._supportedMobileDetected,void 0===a._requestHandler){var c="0.0.0",d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=function(b){if(b||(b=a.apiVersions.v1_3),!a._apiMap.nativeWin[b])throw"Unknown JSlib API version: "+b;e=a._apiMap.nativeWin[b],f=a._apiMap.nativeLinux[b],g=a._apiMap.nativeMac[b],h=a._apiMap.ieAddon[b],c=a._apiMap.extension[b],i=a._apiMap.mobile[b],k&&(d=a._chromeExtensionFirstVersionWithSelfUpdate)};if(j=a.detectedBrowser.indexOf("IE")>=0,k=a.detectedBrowser.indexOf("Chrome")>=0,l=a.detectedBrowser.indexOf("Firefox")>=0,m=a.detectedBrowser.indexOf("Edge")>=0,n=a.detectedBrowser.indexOf("Safari")>=0,o=a._supportedMobileDetected&&"Android"===b,p=a._supportedMobileDetected&&"iOS"===b,a._supportedMobileDetected||j)if(j)a._requestHandler=new function(){var b={},c=0,d=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e=function(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()},f=function(a,d){var f=e();return b[f]={promise:a,pollStart:c,responseProcessor:d},f},g=function(){return window.lacunaWebPKIExtension},i=function(){if(g()){var a=g().GetAvailableResults();if(null===a)throw"Add-on method GetAvailableResults failed";var d=JSON.parse(a),e=[];for(var f in b)if(b.hasOwnProperty(f)){var h=b[f],j=!1;if(h.sendFailed)j=!0;else{for(var k=null,l=0;l<d.length;l++)if(d[l].requestId==f){k=d[l];break}null!==k?(k.success?(h.responseProcessor&&(k.response=h.responseProcessor(k.response)),h.promise._invokeSuccess(k.response)):h.promise._invokeError(k.exception),j=!0):c>=h.pollStart+120&&(h.promise._invokeError({message:"The operation has timed out",complete:"The operation has timed out",origin:"helper",code:"addon_timeout"}),j=!0)}j&&e.push(f)}for(var m=0;m<e.length;m++)delete b[e[m]];c+=1}setTimeout(i,500)},j=function(b,c){if(a._log("checking extension"),null===g())return void(c>1?setTimeout(function(){j(b,c-1)},200):b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.NOT_INSTALLED,message:"The Web PKI add-on is not installed"}));var d=new a.Promise(null);d.success(function(c){a._nativeInfo={os:"Windows",installedVersion:c},a._compareVersions(c,h)<0?b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.OUTDATED,message:"The Web PKI add-on is outdated (installed version: "+c+", latest version: "+h+")"}):b.promise._invokeSuccess({isInstalled:!0})}),d.fail(function(a){b.promise._invokeError(a)}),k({license:b.license,useDomainNativePool:b.useDomainNativePool,promise:d},"getVersion",null)},k=function(a,c,d,e){if(g()){var h,i=f(a.promise,e),j={requestId:i,license:a.license,useDomainNativePool:a.useDomainNativePool,command:c,request:d};try{var k=g().SendCommand(JSON.stringify(j));k===!1&&(h="Failed to send command to add-on")}catch(l){h="Exception when sending command to add-on: "+l}h&&(a.promise._invokeError({message:"Failed to send command to add-on",complete:h,origin:"helper",code:"addon_send_command_failure"},200),b[i].sendFailed=!0)}else a.promise._invokeError({message:"Add-on not detected",complete:"Add-on not detected",origin:"helper",code:"addon_not_detected"},200)},l=function(a,b){q(b),setTimeout(function(){j(a,25)},200)};this.sendCommand=k,this.checkInstalled=l,i()};else{var r=function(){return window.lacunaWebPkiAppBridge},s=null,t=null,u=!1;a._requestHandler=new function(){var a=function(a,b,c,d){if(null===s&&y(a),null!==s)return void s.sendCommand(a,b,c,d);var e=setInterval(function(){if(null!==s)return clearInterval(e),void s.sendCommand(a,b,c,d)},400)},b=function(a,b){if(null===s&&y(a),null!==s)return void s.checkInstalled(a,b);var c=setInterval(function(){if(null!==s)return clearInterval(c),void s.checkInstalled(a,b)},400)};this.sendCommand=a,this.checkInstalled=b};var v=function(){console.log("use mobile in-app integration"),s=new function(){var b={};r().processResponse=function(a){console.log("Response received: ",a);var c=a;"string"==typeof a&&(c=JSON.parse(a));var d=b[c.requestId];delete b[c.requestId],d&&(c.success?(d.responseProcessor&&(c.response=d.responseProcessor(c.response)),d.promise._invokeSuccess(c.response)):d.promise._invokeError(c.exception))};var c=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},d=function(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()},e=function(a,c){var e=d();return b[e]={promise:a,responseProcessor:c},e},f=function(a,b,c,d){var f=e(a.promise,d),g={requestId:f,license:a.license,command:b,request:c},h=JSON.stringify(g);console.log("Sending message: "+h),r().processRequest(h)},g=function(b,c){q(c);var d=new a.Promise(null);d.success(function(c){a._nativeInfo={os:c.os,installedVersion:c.version};var d=a.installationStates.INSTALLED;a._compareVersions(c.version,i)<0&&(d=a.installationStates.OUTDATED),b.promise._invokeSuccess({nativeInfo:{os:c.os,installedVersion:c.version},isInstalled:d===a.installationStates.INSTALLED,status:d})}).fail(function(a){b.promise._invokeError(a)}),f({license:b.license,useDomainNativePool:b.useDomainNativePool,promise:d},"getInfo",null)};this.sendCommand=f,this.checkInstalled=g};
},w=function(){console.log("use mobile signalr integration");var b=null,c="https://cloud.lacunasoftware.com/scripts/signalr-client-1.0.4.min.js",d="https://cloud.lacunasoftware.com/js/forge-cipher.min.js",e={require:"require",window:"window"},f=null;if("object"!=typeof exports&&"function"==typeof require&&"function"==typeof define&&define.amd)require([c],function(b){a._signalR=b}),require([d],function(b){a._forge=b}),f=e.require;else{var g=document.createElement("script");g.setAttribute("src",c),document.getElementsByTagName("head")[0].appendChild(g),g=document.createElement("script"),g.setAttribute("src",d),document.getElementsByTagName("head")[0].appendChild(g),f=e.window}s=new function(){var c=[],d="https://cloud.lacunasoftware.com/",g=d+"api/sessions/",l=d+"session/",m=null,n=!1,r=null,s=!1,u=3,v=5e3,w=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},x=function(){c=[],m=null,s=!1},y=function(){return w()+w()+"-"+w()+"-"+w()+"-"+w()+"-"+w()+w()+w()},z=function(){c.shift(),A()},A=function(){if(c.length>0){var b=c[0];b.time=(new Date).getTime(),b.sendAttempt++,console.log("[Signal] resending request (attempt "+b.sendAttempt+"): "+b.requestId),M(g+m+"/request",b.data,function(c){c&&c.sentToDevice||!(b.sendAttempt>=u)||(b.promise._invokeError({message:"Could not send message to mobile",code:a.errorCodes.MOBILE_SEND_MESSAGE}),z())},function(c,d){b.sendAttempt>=u&&(b.promise._invokeError({message:"Error while sending message to mobile: "+c,complete:"string"==typeof d?d:JSON.stringify(d),code:a.errorCodes.MOBILE_SEND_MESSAGE}),z())}),b.sendAttempt<=1&&C(b)}},B=function(b){b.promise._invokeError({message:"The mobile is not responding",complete:"The operation has timed out",origin:"jslib",code:a.errorCodes.MOBILE_TIMEOUT}),z()},C=function(a){if(!D(a.requestId))return void console.log("[Signal] stop request timeout (shift): "+a.requestId);var b=(new Date).getTime();if(a.receipt){if(b>a.time+6e4)return B(a),void console.log("[Signal] stop request timeout (long timeout): "+a.requestId)}else if(b>a.time+v){if(!(a.sendAttempt<u))return B(a),void console.log("[Signal] stop request timeout (short timeout): "+a.requestId);A()}setTimeout(function(){C(a)},1e3)},D=function(a){return 0!==c.length&&c[0].requestId===a},E=function(a){return D(a)?c[0]:null},F=function(a){var b=E(a);null!==b?(b.receipt=!0,console.log("[Signal] got receipt for request: "+a)):console.log("[Signal] disposed! Got receipt for DISPOSED request: "+a)},G=function(a,b,d,e){if(null==m)throw"The component is not initialized. Make sure the init method was called.";var f={requestId:y(),license:a.license,useDomainNativePool:a.useDomainNativePool,command:b,request:d,domain:window.location.hostname},g=f?j(JSON.stringify(f),r):null,h={type:"request",id:f.requestId,content:g};c.push({requestId:f.requestId,promise:a.promise,responseProcessor:e,data:h,receipt:!1,sendAttempt:0}),c.length<=1&&A()},H=function(a,b){x(),q(b),I(a)},I=function(b,c){return c=c||1,n?void J(b):c>50?void b.promise._invokeError({message:"Dependency scripts did not load",complete:"Dependency scripts did not load",code:a.errorCodes.UNDEFINED}):void setTimeout(function(){I(b,c+1)},200)},J=function(c){var d=null,e=function(a){b.hide();try{a.stop()}catch(c){console.log("[Signal] error while stopping signalR",c)}},f=function(a,b){if(b=b||1,!s){console.log("[Signal] waiting device connection");var d=7;return p&&(d=5),b>d?(e(a),void c.instance.redirectToInstallPage()):void setTimeout(function(){f(a,b+1)},2e3)}};O(l,function(e){e.on("connected",function(d){s=!0,b.hide(),console.log("[Signal] device connected");var e=new a.Promise(null);e.success(function(b){var d=a.installationStates.INSTALLED;a._compareVersions(b.version,i)<0&&(d=a.installationStates.OUTDATED),c.promise._invokeSuccess({nativeInfo:{os:b.os,installedVersion:b.version},isInstalled:d===a.installationStates.INSTALLED,status:d})}).fail(function(a){c.promise._invokeError(a)}),console.log("[Signal] sending first command"),G({license:c.license,useDomainNativePool:c.useDomainNativePool,promise:e},"getInfo",null)}),e.on("message",function(a){console.log("[Signal] available response"),L(g+m+"/response",K)}),e.on("connectionId",function(a){console.log("[Signal] Got connection id: "+a),d=a}),e.on("receipt",function(a){F(a)}),e.onclose(function(a){console.log("[Signal] disconnected",a)})}).then(function(i){var j=function(k){if(console.log("[Signal] Getting connection Id"),k=k||1,k>10)return console.log("[Signal] Fail. ConnectionId timeout"),void c.promise._invokeError({message:"Connection Id timeout",complete:"Did not get connection Id event.",code:a.errorCodes.UNDEFINED});if(!d)return void setTimeout(function(){j(k+1)},1e3);console.log("[Signal] Getting session");var l={connectionId:d};M(g,l,function(d){m=d.sessionId,r=h(),console.log("[Signal] session started"),console.log("[Signal] showing modal deep link");var g="start?s="+m+"&k="+r.hex+"&b="+a.detectedBrowser+"&o="+window.location.hostname,j="webpki://"+g;o&&(j="intent://"+g+"#Intent;scheme=webpki;S.browser_fallback_url="+encodeURIComponent(a._installUrl+(c.instance.brand||"")+"?returnUrl="+encodeURIComponent(document.URL)+"&jslib="+a._jslibVersion)+";end"),b=new t(j),b.onOkCLick=function(){b.showWait(),f(i)},b.onCancelClick=function(){e(i),c.promise._invokeError({message:"Start mobile app cancelled",complete:"Start mobile app cancelled",code:a.errorCodes.USER_CANCELLED})},b.show()})};setTimeout(j,100)})},K=function(b){b="string"==typeof b?JSON.parse(b):b,console.log("[Signal] got response. Type: "+b.type);var c={};try{if(0!=b.format)throw{message:"Unknown data format: "+b.format};c="Error"!==b.type?JSON.parse(k(b.content,r)):{requestId:b.id,success:!1,exception:b.content?"string"==typeof b.content?JSON.parse(b.content):b.content:{message:"Cryptographic error on mobile native",error:"Cryptographic error on mobile native",code:a.errorCodes.COMMAND_DECRYPT_ERROR}}}catch(d){c={requestId:b.id,success:!1,exception:{message:"Error while decrypting response message",error:"object"==typeof d?d.message||JSON.stringify(d):d,code:a.errorCodes.COMMAND_DECRYPT_ERROR}}}var e=E(b.id);return null===e?void console.log("[Signal] got response for disposed request: "+b.id):(c.success?(e.responseProcessor&&(c.response=e.responseProcessor(c.response)),e.promise._invokeSuccess(c.response)):e.promise._invokeError(c.exception),void z())},L=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){N(d,"GET",a,b,c)},d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.withCredentials=!1,console.log("[HttpHandler] Get "+a),d.send()},M=function(a,b,c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){N(e,"POST",a,c,d)},e.open("POST",a,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept","application/json"),e.withCredentials=!1,console.log("[HttpHandler] Post on ("+a+"): ",b),e.send(JSON.stringify(b))},N=function(a,b,c,d,e){if(4===a.readyState)if(a.status>=200&&a.status<=299){var f=null;if(200===a.status||201===a.status)try{f=JSON.parse(a.responseText),d(f)}catch(g){console.log("[HttpHandler] error parsing response."),f=a.responseText,e(a.status,f)}console.log("[HttpHandler] received response from "+b+" "+c,f)}else if(0===a.status&&!a.responseText&&p)console.log("[HttpHandler] got Safari abort connection. Applying workaround"),d({sentToDevice:!0});else{var h;try{h=JSON.parse(a.responseText)}catch(g){console.log("[HttpHandler] error parsing error"),h=null}console.log("[HttpHandler] error: "+a.responseText),e(a.status,h)}},O=null;!function(){var b=function(c){if(c=c||1,c>100)throw"Script "+(a._forge||a._signalR?a._forge?"signalR":"forge":"forge / signalR")+" did not load";f!==e.require&&(a._signalR=window.signalR,a._forge=window.forge),void 0!==a._signalR&&void 0!==a._forge?(O=function(b,c){return function(){console.log("[Signal] Starting connection");var d=(new a._signalR.HubConnectionBuilder).withUrl(b).build();return c&&"function"==typeof c&&c(d),d.start().then(function(){return d})["catch"](function(a){return console.log("[Signal] Cannot start the connection. Erro: ",a),window.Promise.reject(a)})}()},n=!0):setTimeout(function(){b(c+1)},200)};setTimeout(function(){b()},50)}(),this.sendCommand=G,this.checkInstalled=H};var h=function(){var b=a._forge.random.getBytesSync(32);return{raw:b,b64:a._forge.util.encode64(b),hex:a._forge.util.bytesToHex(b)}},j=function(b,c){var d=a._forge.random.getBytesSync(16),e=c.raw,f=new a._forge.util.ByteBuffer;f.putBuffer(a._forge.util.createBuffer(b));var g=a._forge.cipher.createCipher("AES-CBC",e);g.start({iv:d}),g.update(f),g.finish();var h=g.output.bytes(),i=a._forge.hmac.create();i.start("sha256",e),i.update(h),hmacContent=i.digest().bytes();var j=new a._forge.util.ByteBuffer;return j.putBytes(d),j.putBytes(hmacContent),j.putBytes(h),a._forge.util.encode64(j.bytes())},k=function(b,c){var d=c.raw,e=new a._forge.util.ByteBuffer;e.putBytes(a._forge.util.decode64(b));var f=e.getBytes(16),g=e.getBytes(32),h=e.bytes(),i=a._forge.hmac.create();i.start("sha256",d),i.update(h);var j=i.digest().bytes();if(j!==g)throw{message:"Error on message integrity"};var k=a._forge.cipher.createDecipher("AES-CBC",d);k.start({iv:f}),k.update(e);var l=k.finish();if(!l)throw{message:"Error on message decryption"};return a._forge.util.decodeUtf8(k.output.getBytes())}},x=function(b){s=new function(){var c="-lcn",d="wpki"+c,e="access?u="+encodeURIComponent(window.location.href)+"&c="+encodeURIComponent(document.cookie),f=d+"://"+e;o&&(f="intent://"+e+"#Intent;scheme="+d+";S.browser_fallback_url="+encodeURIComponent(a._installUrl+(b.instance.brand||"")+"?returnUrl="+encodeURIComponent(document.URL)+"&jslib="+a._jslibVersion)+";end"),this.sendCommand=function(a,b,c,d){},this.checkInstalled=function(b,c){var d=new t(f);d.onOkCLick=function(){d.showWait();var a=new Date;setTimeout(function(){d.hide(),p&&new Date-a<1e4&&b.instance.redirectToInstallPage()},5e3)},d.onCancelClick=function(){d.hide(),b.promise._invokeError({message:"Start mobile app cancelled",complete:"Start mobile app cancelled",code:a.errorCodes.USER_CANCELLED})},d.show()}}},y=function(b){if(!u){u=!0;var c=10,d=setInterval(function(){return console.log("polling mobile integration mode ..."),c<=0?(clearInterval(d),void(b.instance.mobileIntegrationMode===a.mobileIntegrationModes.browserIntegration?w():x(b))):r()&&r().loaded?(clearInterval(d),void v()):void c--},300)}};t=function(a){this.deepLink=a,this.onOkCLick=null,this.onCancelClick=null;var b=null,c={pt:{accessCertificates:"O site {{domain}} deseja acessar seus certificados digitais.",authorize:"Permitir",cancel:"Cancelar",wait:"Aguarde..."},en:{accessCertificates:"The website {{domain}} wants to access your digital certificates.",authorize:"Authorize",cancel:"Cancel",wait:"Please wait..."},es:{accessCertificates:"El sitio {{domain}} quiere acceder a sus certificados digitales.",authorize:"Permitir",cancel:"Cancelar",wait:"Espera..."}},d=null,e=function(a){if(null===d){var b=window.navigator.language||"en",e=Object.keys(c);d=e.indexOf(b)>-1?b:b.length>1&&e.indexOf(b.substring(0,2))>-1?b.substring(0,2):"en"}return c[d][a]||a},f=function(a){b=document.getElementById("webPkiModal"),null!=b&&(b.removeChild(b.firstChild),document.getElementsByTagName("body")[0].removeChild(b)),b=document.createElement("div"),b.setAttribute("id","webPkiModal"),b.setAttribute("style","display: none;");var c=document.createElement("div");c.setAttribute("style",'display: table; background-color: #fefefe; margin: 5%; width: 90%; height: 90%; font-family: "Helvetica"; text-align: center; border-radius: 10px;');var d=document.createElement("div");d.setAttribute("style","display: table-cell; vertical-align: middle;");var f=document.createElement("p");f.setAttribute("id","webPkiWaitElement"),f.setAttribute("style","display: none"),f.appendChild(document.createTextNode(e("wait")));var g=document.createElement("p");g.setAttribute("id","webPkiTextElement"),g.setAttribute("style","padding-left: 5%; padding-right: 5%; font-size: 1.6em; color: black; word-wrap: break-word; white-space: normal;"),g.appendChild(document.createTextNode(e("accessCertificates").split("{{domain}}")[0]));var h=document.createElement("strong");h.appendChild(document.createTextNode(window.location.hostname)),g.appendChild(h),g.appendChild(document.createTextNode(e("accessCertificates").split("{{domain}}")[1]));var i=document.createElement("div");i.setAttribute("id","webPkiButtonsElement");var j=document.createElement("a");j.setAttribute("style","-webkit-appearance: button; -moz-appearance: button; appearance: button; padding: 2% 4%; text-align: center; text-decoration: none; display: inline-block; font-size: 1.1em; margin: 5%; cursor: pointer; background-color: #e7e7e7; color: black"),j.appendChild(document.createTextNode(e("cancel")));var k=document.createElement("a");k.setAttribute("style","-webkit-appearance: button; -moz-appearance: button; appearance: button; padding: 2% 4%; text-align: center; text-decoration: none; display: inline-block; font-size: 1.1em; margin: 5%; cursor: pointer; background-color: #0078e7; color: white"),k.setAttribute("id","wpkiModalDeepLink"),k.setAttribute("href",a.deepLink),k.appendChild(document.createTextNode(e("authorize"))),p?(i.appendChild(j),i.appendChild(k)):(i.appendChild(k),i.appendChild(j)),d.appendChild(f),d.appendChild(g),d.appendChild(i),c.appendChild(d),b.appendChild(c),document.getElementsByTagName("body")[0].appendChild(b),k.onclick=a.onOkCLick,j.onclick=a.onCancelClick};this.hide=function(){b.setAttribute("style","display: none;")},this.show=function(){f(this),b.setAttribute("style","display: block; position: fixed; z-index: 100000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);")},this.showWait=function(){document.getElementById("webPkiTextElement").setAttribute("style","display: none;"),document.getElementById("webPkiButtonsElement").setAttribute("style","display: none;"),document.getElementById("webPkiWaitElement").setAttribute("style","padding-left: 5%; padding-right: 5%; font-size: 1.6em; color: black; word-wrap: break-word;")}}}else a._requestHandler=new function(){var b="com.lacunasoftware.WebPKI.RequestEvent",h="com.lacunasoftware.WebPKI.ResponseEvent",i={};m&&"stable"!==a._buildChannel&&(b="com.lacunasoftware.WebPKI.RequestEvent",h="com.lacunasoftware.WebPKI.ResponseEvent");var j=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},l=function(){return j()+j()+"-"+j()+"-"+j()+"-"+j()+"-"+j()+j()+j()},n=function(a,b){var c=l();return i[c]={promise:a,responseProcessor:b},c},o=function(a,c,d,e){var f=n(a.promise,e),g={requestId:f,license:a.license,useDomainNativePool:a.useDomainNativePool,command:c,request:d};if(k){var h=new CustomEvent("build",{detail:g});h.initEvent(b),document.dispatchEvent(h)}else if(m){var i=new CustomEvent(b,{detail:g});document.dispatchEvent(i)}else window.postMessage({port:b,message:g},"*")},p=function(a,b){q(b),setTimeout(function(){r(a,25)},200)},r=function(b,c){a._log("polling extension");var d=document.getElementById(a._chromeExtensionId)||document.getElementById(a._firefoxExtensionId.replace(/[^A-Za-z0-9_]/g,"_"))||document.getElementById(a._edgeExtensionId);return null===d?void(c>1?setTimeout(function(){r(b,c-1)},200):b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.NOT_INSTALLED,message:"The Web PKI extension is not installed",browserSpecificStatus:a._chromeInstallationStates.EXTENSION_NOT_INSTALLED})):void s(b)},s=function(b){a._log("checking extension version");var e=new a.Promise(null);e.success(function(e){if(a._compareVersions(e,c)<0){var f=null!==d&&a._compareVersions(e,d)>=0;b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.OUTDATED,browserSpecificStatus:a._chromeInstallationStates.EXTENSION_OUTDATED,message:"The Web PKI extension is outdated (installed version: "+e+", required version: "+c+")",chromeExtensionCanSelfUpdate:f})}else t(b)}),e.fail(function(a){b.promise._invokeError(a)}),o({license:b.license,useDomainNativePool:b.useDomainNativePool,promise:e},"getExtensionVersion",null)},t=function(b){a._log("initializing extension");var c=new a.Promise(null);c.success(function(c){c.isReady?(a._nativeInfo=c.nativeInfo,"Windows"===c.nativeInfo.os&&a._compareVersions(c.nativeInfo.installedVersion,e)<0?b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.OUTDATED,browserSpecificStatus:a._chromeInstallationStates.NATIVE_OUTDATED,message:"The Web PKI native component is outdated (installed version: "+c.nativeInfo.installedVersion+", required version: "+e+")",platformInfo:c.platformInfo,nativeInfo:c.nativeInfo}):"Linux"===c.nativeInfo.os&&a._compareVersions(c.nativeInfo.installedVersion,f)<0?b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.OUTDATED,browserSpecificStatus:a._chromeInstallationStates.NATIVE_OUTDATED,message:"The Web PKI native component is outdated (installed version: "+c.nativeInfo.installedVersion+", required version: "+f+")",platformInfo:c.platformInfo,nativeInfo:c.nativeInfo}):"Darwin"===c.nativeInfo.os&&a._compareVersions(c.nativeInfo.installedVersion,g)<0?b.promise._invokeSuccess({isInstalled:!1,status:a.installationStates.OUTDATED,browserSpecificStatus:a._chromeInstallationStates.NATIVE_OUTDATED,message:"The Web PKI native component is outdated (installed version: "+c.nativeInfo.installedVersion+", required version: "+g+")",platformInfo:c.platformInfo,nativeInfo:c.nativeInfo}):b.promise._invokeSuccess({isInstalled:!0})):b.promise._invokeSuccess({isInstalled:!1,status:u(c.status),browserSpecificStatus:c.status,message:c.message,platformInfo:c.platformInfo,nativeInfo:c.nativeInfo})}),c.fail(function(a){b.promise._invokeError(a)}),o({license:b.license,useDomainNativePool:b.useDomainNativePool,promise:c},"initialize",null)},u=function(b){return b===a._chromeInstallationStates.INSTALLED?a.installationStates.INSTALLED:b===a._chromeInstallationStates.EXTENSION_OUTDATED||b===a._chromeInstallationStates.NATIVE_OUTDATED?a.installationStates.OUTDATED:a.installationStates.NOT_INSTALLED},v=function(a){var b=i[a.requestId];delete i[a.requestId],a.success?(b.responseProcessor&&(a.response=b.responseProcessor(a.response)),b.promise._invokeSuccess(a.response)):b.promise._invokeError(a.exception)};this.sendCommand=o,this.checkInstalled=p,k||m?document.addEventListener(h,function(a){v(a.detail)}):window.addEventListener("message",function(a){a&&a.data&&a.data.port===h&&v(a.data.message)})}}}(LacunaWebPKI.prototype),"object"==typeof exports&&(Object.defineProperties?Object.defineProperties(exports,{"default":{value:LacunaWebPKI},__esModule:{value:!0},LacunaWebPKI:{value:LacunaWebPKI}}):(exports["default"]=LacunaWebPKI,exports.__esModule=!0,exports.LacunaWebPKI=LacunaWebPKI));